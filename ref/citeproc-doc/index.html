<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.4.1: http://docutils.sourceforge.net/" />
<title>Citation Style Language</title>
<style type="text/css">

body { 
    width: 750px; 
    margin: auto; 
    position: center; 
    font-family: 'Lucida Sans', Verdana, sans-serif; 
    font-size: 10.5pt; 
    color: #434343;
    line-height: 130%; !important
}

.xml { padding: 1em; border: silver 1px solid; background: #EAFABC; }
.relaxngcompact { padding: 1em; border: silver 1px solid; background: #F6F9ED; }

.clothesline {
  position: relative;
}

/* .js { padding: 1em; border: silver 1px solid; background: #FFF68F; } */
.js { padding: 1em; border: silver 1px solid; background: #EAFABC; }
.text { padding: 1em; border: silver 1px solid; background: #FFcccc; }

dl { background: #B7FCE1; padding:1em; border: silver 1px solid;}
dt { font-weight: bold; margin-top: 0.5em; }
.info-version { text-align: center; font-size: 130%; font-weight: bold; }
.info-date { text-align: center; font-size: 110%; font-weight: bold; }
.title { text-align: center; margin: 4em 4em 1em 4em; }
.subtitle { text-align: center; margin: 1em 4em 4em 4em; }
.topic-title { font-weight: bold; font-size: 130%; }
.contents { margin-bottom: 1em; }

.contributors { margin-left: 250px; margin-top: 2em; margin-bottom: 2em; }
dl.contributors { background: white; border: none; }
.contributors dt { margin: 1em; }

span.sc {
  font-variant: small-caps;
  color: black;
}

tt.literal .pre {
  font-family: monospace;
  color: #232323;
  background: #d9d9d9;
  padding: 1px 2px 0px 2px;
}

a { 
    border-bottom: dotted 1px #999; 
    text-decoration: none;
}

blockquote {
    background: #B7FCE1; 
    margin-left: 3em;
    padding:1em; 
    border: silver 1px solid;
}

.superscript {
  margin-bottom: 1em;
}

a.toc-backref tt.literal .pre {
    background: white;
}

a:link { color: #636363; font-weight: bold;}
a:visited { color: #636363; font-weight: bold; }
a:active { color: #636363; font-weight: bold; }
a:hover { color: #a30826; font-weight: bold; }

a tt.literal .pre:link { color: #131313; }
a tt.literal .pre:visited { color: #131313; }
a tt.literal .pre:active { color: #131313; }
a tt.literal .pre:hover { color: #a30826; }

.contents a:link { color: #434343; font-weight: normal; }
.contents a:visited { color: #434343; font-weight: normal; }
.contents a:active { color: #434343; font-weight: normal; }
.contents a:hover { color: #a30826; }

a.toc-backref:link { color: black; } 
a.toc-backref:visited { color: black; } 
a.toc-backref:active { color: black; } 
a.toc-backref:hover { color: #a30826; } 

blockquote.clothesline {
  position: relative;
  padding: 0px;
  margin: 0px;
  border: 0px none;
}

div.admonition {
  border: 3px solid #c0c0c0;
  float: right;
  width: 37%;
  padding: 0px 5px 0px 5px;
  background: white;
  margin: -1em -1em 0px 5px;
}

blockquote.clothesline div.admonition {
  float: none;
  position: absolute;
  top: 0em;
  right: 0em;
}

div.admonition p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

div.admonition-important .admonition-title:before {
  content: url("important.png");
  padding-right: 5px;
}

div.admonition-hint .admonition-title:before {
  content: url("ktip.png");
  padding-right: 5px;
}

div.admonition p.admonition-title {
  font-weight: bold;
  font-size: 150%;
  border-bottom: 1px solid black;
  margin-top: 0px;
  margin-bottom: 0px;
  padding-top: 3px;
  padding-bottom: 3px;
}

table.footnote {
  background: #ffffdd;
  padding: 5px 0px 5px 0px;
  border: 1px solid #cccccc;
  margin: 0.3em 0px 0.3em 0px;
}

table.first {
  margin: 2.3em 0px 0.3em 0px;
}

table.hello { margin-left: 3em; }
table.hello td { padding: 3px; }
table.hello th { padding: 3px; background: #dddddd; }

table.footnote td.label {
  white-space: nowrap;
  padding-right: 0.3em;
}

a.fn-backref:before {
  content: url("2uparrow.png");
  padding-right: 2px;
}

a.footnote-reference {
  background: #ffffdd;
  padding: 5px 2px 0px 2px;
  white-space: nowrap;
}

a.footnote-reference:before {
  content: url("2downarrow.png");
  padding-right: 2px;
}

a.fn-backref {
  vertical-align: top;
}

/* .nx { color: red; font-weight: bold } */ /* Function name */

.c { color: #408080; font-style: italic } /* Comment */
.err { border: 1px solid #FF0000 } /* Error */

.k { color: #007020; font-weight: bold } /* Keyword  [DONE] */
.o { color: #666666 } /* Operator */
.cm { color: #408080; font-style: italic } /* Comment.Multiline */
.cp { color: #BC7A00 } /* Comment.Preproc */
.c1 { color: #408080; font-style: italic } /* Comment.Single */
.cs { color: #408080; font-style: italic } /* Comment.Special */
.gd { color: #A00000 } /* Generic.Deleted */
.ge { font-style: italic } /* Generic.Emph */
.gr { color: #FF0000 } /* Generic.Error */
.gh { color: #000080; font-weight: bold } /* Generic.Heading */
.gi { color: #00A000 } /* Generic.Inserted */
.go { color: #808080 } /* Generic.Output */
.gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.gs { font-weight: bold } /* Generic.Strong */
.gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.gt { color: #0040D0 } /* Generic.Traceback */
.kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.kp { color: #008000 } /* Keyword.Pseudo */
.kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.kt { color: #B00040 } /* Keyword.Type */
.m { color: #666666 } /* Literal.Number */
.s { color: #BA2121 } /* Literal.String */
.na { color: #7D9029 } /* Name.Attribute */
.nb { color: #008000 } /* Name.Builtin */
.nc { color: #0000FF; font-weight: bold } /* Name.Class */
.no { color: #880000 } /* Name.Constant */
.nd { color: #AA22FF } /* Name.Decorator */
.ni { color: #999999; font-weight: bold } /* Name.Entity */
.ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.nf { color: #0000FF } /* Name.Function */
.nl { color: #A0A000 } /* Name.Label */
.nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.nt { color: #008000; font-weight: bold } /* Name.Tag */
.nv { color: #19177C } /* Name.Variable */
.ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.w { color: #bbbbbb } /* Text.Whitespace */
.mf { color: #666666 } /* Literal.Number.Float */
.mh { color: #666666 } /* Literal.Number.Hex */
.mi { color: #666666 } /* Literal.Number.Integer */
.mo { color: #666666 } /* Literal.Number.Oct */
.sb { color: #BA2121 } /* Literal.String.Backtick */
.sc { color: #BA2121 } /* Literal.String.Char */
.sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.s2 { color: #BA2121 } /* Literal.String.Double */
.se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.sh { color: #BA2121 } /* Literal.String.Heredoc */
.si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.sx { color: #008000 } /* Literal.String.Other */
.sr { color: #BB6688 } /* Literal.String.Regex */
.s1 { color: #BA2121 } /* Literal.String.Single */
.ss { color: #19177C } /* Literal.String.Symbol */
.bp { color: #008000 } /* Name.Builtin.Pseudo */
.vc { color: #19177C } /* Name.Variable.Class */
.vg { color: #19177C } /* Name.Variable.Global */
.vi { color: #19177C } /* Name.Variable.Instance */
.il { color: #666666 } /* Literal.Number.Integer.Long */

table.codeblock, tr.codeblock, td.linenos, td.codeblock, table.codeblock pre { 
	margin: 0; 
	padding: 0; 
	border: 0; 
	vertical-align: baseline; 
	border: none; 
}

td.linenos { 
	border-right: 1px solid #AAAAAA; 
	text-align: right; 
	color: #AAAAAA; 
	padding-right: 5px; 
	padding-left: 5px; 
}

.codeblock { font-size: 110%; }

td.codeblock { padding-left: 5px; }
pre.codeblock { }
pre.codeblock span.Normal { }

pre.codeblock span.DataType { color: #902000; }
pre.codeblock span.DecVal { color: #40a070; }
pre.codeblock span.BaseN { color: #40a070; }
pre.codeblock span.Float { color: #40a070; }
pre.codeblock span.Char { color: #4070a0; }
pre.codeblock span.String { color: #4070a0; }
pre.codeblock span.Comment { color: #60a0b0; font-style: italic; }
pre.codeblock span.Others { color: #007020; }
pre.codeblock span.Alert { color: red; font-weight: bold; }
pre.codeblock span.Function { color: #06287e; }
pre.codeblock span.RegionMarker { }
pre.codeblock span.Error { color: red; font-weight: bold; }

</style>
</head>
<body>
<div class="document" id="citation-style-language">
<h1 class="title">Citation Style Language</h1>
<h2 class="subtitle" id="manual-for-the-citeproc-js-processor">Manual for the <tt class="docutils literal"><span class="pre">citeproc-js</span></tt> Processor</h2>
<p class="info-version">version X.XX</p>
<p class="info-date">October, 2009</p>
<dl class="contributors docutils">
<dt>Author</dt>
<dd><ul class="first last simple">
<li>Frank G. Bennett, Jr.</li>
</ul>
</dd>
<dt>Contributors</dt>
<dd><ul class="first last simple">
<li>Bruce D'Arcus</li>
<li>Dan Stillman</li>
<li>Rintze Zelle</li>
</ul>
</dd>
</dl>
<hr class="docutils" />
<div class="contents topic">
<p class="topic-title first"><a id="table-of-contents" name="table-of-contents">Table of Contents</a></p>
<ul class="simple">
<li><a class="reference" href="#introduction" id="id26" name="id26">Introduction</a></li>
<li><a class="reference" href="#commands" id="id27" name="id27">Commands</a><ul>
<li><a class="reference" href="#csl-engine" id="id28" name="id28"><tt class="docutils literal"><span class="pre">CSL.Engine()</span></tt></a></li>
<li><a class="reference" href="#updateitems" id="id29" name="id29"><tt class="docutils literal"><span class="pre">updateItems()</span></tt></a></li>
<li><a class="reference" href="#makebibliography" id="id30" name="id30"><tt class="docutils literal"><span class="pre">makeBibliography()</span></tt></a></li>
<li><a class="reference" href="#makecitationcluster" id="id31" name="id31"><tt class="docutils literal"><span class="pre">makeCitationCluster()</span></tt></a></li>
</ul>
</li>
<li><a class="reference" href="#local-environment" id="id32" name="id32">Local Environment</a><ul>
<li><a class="reference" href="#state-aware-data-preparation" id="id33" name="id33">State-aware data preparation</a></li>
<li><a class="reference" href="#system-functions" id="id34" name="id34">System functions</a><ul>
<li><a class="reference" href="#retrievelocale" id="id35" name="id35"><tt class="docutils literal"><span class="pre">retrieveLocale()</span></tt></a></li>
<li><a class="reference" href="#retrieveitem" id="id36" name="id36"><tt class="docutils literal"><span class="pre">retrieveItem()</span></tt></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference" href="#data-input" id="id37" name="id37">Data Input</a><ul>
<li><a class="reference" href="#item-fields" id="id38" name="id38">Item fields</a><ul>
<li><a class="reference" href="#text-and-numeric-variables" id="id39" name="id39">Text and numeric variables</a></li>
<li><a class="reference" href="#names" id="id40" name="id40">Names</a><ul>
<li><a class="reference" href="#names-with-particles" id="id41" name="id41">Names with particles</a></li>
<li><a class="reference" href="#non-byzantine-names" id="id42" name="id42">&quot;non-Byzantine&quot; names</a></li>
</ul>
</li>
<li><a class="reference" href="#dates" id="id43" name="id43">Dates</a></li>
<li><a class="reference" href="#categories" id="id44" name="id44">Categories</a></li>
</ul>
</li>
<li><a class="reference" href="#citation-fields" id="id45" name="id45">Citation fields</a><ul>
<li><a class="reference" href="#locator" id="id46" name="id46">Locator</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference" href="#dirty-tricks" id="id47" name="id47">Dirty Tricks</a><ul>
<li><a class="reference" href="#input-data-rescue" id="id48" name="id48">Input data rescue</a><ul>
<li><a class="reference" href="#id14" id="id49" name="id49">Names</a></li>
<li><a class="reference" href="#id15" id="id50" name="id50">Dates</a></li>
</ul>
</li>
<li><a class="reference" href="#journal-abbreviation-lists" id="id51" name="id51">Journal Abbreviation Lists</a></li>
<li><a class="reference" href="#processor-control" id="id52" name="id52">Processor control</a><ul>
<li><a class="reference" href="#author-only" id="id53" name="id53"><tt class="docutils literal"><span class="pre">author-only</span></tt></a></li>
<li><a class="reference" href="#suppress-author" id="id54" name="id54"><tt class="docutils literal"><span class="pre">suppress-author</span></tt></a></li>
<li><a class="reference" href="#automating-text-insertions" id="id55" name="id55">Automating text insertions</a></li>
</ul>
</li>
<li><a class="reference" href="#id21" id="id56" name="id56">Multi-lingual content</a><ul>
<li><a class="reference" href="#the-lang-declaration" id="id57" name="id57">The <tt class="docutils literal"><span class="pre">lang</span></tt> declaration</a></li>
<li><a class="reference" href="#title" id="id58" name="id58">Title</a></li>
<li><a class="reference" href="#id24" id="id59" name="id59">Names</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference" href="#test-suite" id="id60" name="id60">Test Suite</a><ul>
<li><a class="reference" href="#fixture-layout" id="id61" name="id61">Fixture layout</a></li>
<li><a class="reference" href="#preprocessors-forthcoming" id="id62" name="id62">Preprocessors [forthcoming]</a><ul>
<li><a class="reference" href="#std-grind-py-forthcoming" id="id63" name="id63"><tt class="docutils literal"><span class="pre">./std/grind.py</span></tt> [forthcoming]</a></li>
<li><a class="reference" href="#tools-maketests-sh-forthcoming" id="id64" name="id64"><tt class="docutils literal"><span class="pre">./tools/MAKETESTS.sh</span></tt> [forthcoming]</a></li>
</ul>
</li>
<li><a class="reference" href="#test-runners-forthcoming" id="id65" name="id65">Test runners [forthcoming]</a><ul>
<li><a class="reference" href="#runtests-sh-forthcoming" id="id66" name="id66"><tt class="docutils literal"><span class="pre">./runtests.sh</span></tt> [forthcoming]</a></li>
<li><a class="reference" href="#test-py-forthcoming" id="id67" name="id67"><tt class="docutils literal"><span class="pre">./test.py</span></tt> [forthcoming]</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference" href="#running-the-processor-forthcoming" id="id68" name="id68">Running the Processor [forthcoming]</a><ul>
<li><a class="reference" href="#under-python-via-python-spidermonkey-forthcoming" id="id69" name="id69">Under Python via <tt class="docutils literal"><span class="pre">python-spidermonkey</span></tt> [forthcoming]</a></li>
<li><a class="reference" href="#under-java-via-rhino-forthcoming" id="id70" name="id70">Under Java via <tt class="docutils literal"><span class="pre">rhino</span></tt> [forthcoming]</a></li>
</ul>
</li>
</ul>
</div>
<hr class="docutils" />
<div class="section">
<h1><a class="toc-backref" href="#id26" id="introduction" name="introduction">Introduction</a></h1>
<p>This is the site administrator's manual for <tt class="docutils literal"><span class="pre">citeproc-js</span></tt>, a
Javascript implementation of the Citation Style Language (CSL) used by
Zotero, Mendeley and other popular reference managers.  The processor
complies with version 1.0 of the CSL specification, has been written
and tested as an independent module, and can be run by any
ECMAscript-compliant interpreter.  With an appropriate supporting
environment, <a class="footnote-reference" href="#id2" id="id1" name="id1">[1]</a> it can be deployed in a browser plugin, as part of a
desktop application, or as a formatting backend for a website or web
service.</p>
<p>This manual covers the basic operation of the processor, including the
command set, the local system code that must be supplied by the integrator, and the
expected format of input data.  In addition, notes are provided on the test suite,
on the infrastructure requirements for running the processor in particular
environments, and on extended functionality that is available to address certain
special requirements.</p>
<p>Comments and complaints relating to this document and to the processor itself
will be gladly received and eventually despatched with.  My email address
is <a class="reference" href="mailto:biercenator&#64;gmail.com">biercenator&#64;gmail.com</a></p>
<table class="first docutils footnote" frame="void" id="id2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1" name="id2">[1]</a></td><td>For further details on required infrastructure, see the sections
<img alt="link" src="link.png" /> <a class="reference" href="#local-environment">Local Environment</a>
and <img alt="link" src="link.png" /> <a class="reference" href="#data-input">Data Input</a> below.</td></tr>
</tbody>
</table>
</div>
<div class="section">
<h1><a class="toc-backref" href="#id27" id="commands" name="commands">Commands</a></h1>
<p>The command set will be a grave disappointment to those well versed in
the tormented intricacies of reference management and bibliography
formatting.  The processor is instantiated with a single command, and
controlled with three others.</p>
<div class="section">
<h2><a class="toc-backref" href="#id28" id="csl-engine" name="csl-engine"><tt class="docutils literal"><span class="pre">CSL.Engine()</span></tt></a></h2>
<p>A working instance of the processor can (well, must) be created using the
<tt class="docutils literal"><span class="pre">CSL.Engine()</span></tt> command, as shown in the code illustration below.
This command takes two required and one optional argument:</p>
<div class="admonition-important admonition">
<p class="first admonition-title">Important</p>
<p class="last">See the section <img alt="link" src="link.png" /> <a class="reference" href="_`SystemFunctions`">Local Environment → System Functions</a> below for guidance
on the definition of the functions contained in the <tt class="docutils literal"><span class="pre">sys</span></tt>
object.</p>
</div>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1</pre></td><td class="code"><div class="highlight"><pre><span class="k">var</span> <span class="nx">citeproc</span> <span class="o">=</span> <span class="nx">CSL</span><span class="p">.</span><span class="nx">Engine</span><span class="p">(</span><span class="nx">sys</span><span class="o">,</span> <span class="nx">style</span><span class="o">,</span> <span class="nx">lang</span><span class="p">)</span>
</pre></div>
</td></tr></table>
</div>
<dl class="docutils">
<dt><em>sys</em></dt>
<dd>A Javascript object containing the functions
<tt class="docutils literal"><span class="pre">retrieveLocale()</span></tt> and <tt class="docutils literal"><span class="pre">retrieveItem()</span></tt>.</dd>
<dt><em>style</em></dt>
<dd>A CSL style in serialized (string) form.</dd>
<dt><em>lang</em> (optional)</dt>
<dd>A language tag compliant with RFC 4646.  Defaults to <tt class="docutils literal"><span class="pre">en</span></tt>.</dd>
</dl>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id29" id="updateitems" name="updateitems"><tt class="docutils literal"><span class="pre">updateItems()</span></tt></a></h2>
<p>Before citations or a bibliography can be generated, an ordered
list of reference items must be loaded into the processor using
the <tt class="docutils literal"><span class="pre">updateItems()</span></tt> command, as shown below.  This command
takes a list of item IDs as its sole argument, and will reconcile
the internal state of the processor to the provided list of
items, making any necessary insertions and deletions, and making
any necessary adjustments to internal registers related to
disambiguation and so forth.</p>
<div class="admonition-hint admonition">
<p class="first admonition-title">Hint</p>
<p class="last">The sequence in which items are listed in the
argument to <tt class="docutils literal"><span class="pre">updateItems()</span></tt> will be reflected in the ordering
of bibliographies only if the style installed in the processor
does not impose its own sort order.</p>
</div>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3
4
5
6
7</pre></td><td class="code"><div class="highlight"><pre><span class="k">var</span> <span class="nx">my_ids</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;ID-1&quot;</span><span class="o">,</span>
    <span class="s2">&quot;ID-53&quot;</span><span class="o">,</span>
    <span class="s2">&quot;ID-27&quot;</span>
<span class="p">]</span>

<span class="nx">citeproc</span><span class="p">.</span><span class="nx">updateItems</span><span class="p">(</span> <span class="nx">my_ids</span> <span class="p">);</span>
</pre></div>
</td></tr></table>
</div>
<p>Note that only IDs may be used to identify items.  The ID is an
arbitrary, system-dependent identifier, used by the locally customized
<tt class="docutils literal"><span class="pre">retrieveItem()</span></tt> and <tt class="docutils literal"><span class="pre">retrieveItems()</span></tt> methods to retrieve
actual item data.</p>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id30" id="makebibliography" name="makebibliography"><tt class="docutils literal"><span class="pre">makeBibliography()</span></tt></a></h2>
<p>The <tt class="docutils literal"><span class="pre">makeBibliography()</span></tt> command does what its name implies.  The
command takes one optional argument.  If invoked without an argument,
it dumps a formatted bibliography containing all items currently
registered in the processor:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1</pre></td><td class="code"><div class="highlight"><pre><span class="k">var</span> <span class="nx">mybibliography</span> <span class="o">=</span> <span class="nx">citeproc</span><span class="p">.</span><span class="nx">makeBibliography</span><span class="p">();</span>
</pre></div>
</td></tr></table>
</div>
<p>The optional argument is an arbitrary category name, used to obtain a
bibliography containing only items loaded to the processor with a
matching <tt class="docutils literal"><span class="pre">category</span></tt> element.</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1</pre></td><td class="code"><div class="highlight"><pre><span class="k">var</span> <span class="nx">mybibliography</span> <span class="o">=</span> <span class="nx">citeproc</span><span class="p">.</span><span class="nx">makeBibliography</span><span class="p">(</span><span class="s2">&quot;pre-1990&quot;</span><span class="p">);</span>
</pre></div>
</td></tr></table>
</div>
<p>To print items that are not associated with any category, use
the reserved category name <tt class="docutils literal"><span class="pre">none</span></tt>:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1</pre></td><td class="code"><div class="highlight"><pre><span class="k">var</span> <span class="nx">mybibliography</span> <span class="o">=</span> <span class="nx">citeproc</span><span class="p">.</span><span class="nx">makeBibliography</span><span class="p">(</span><span class="s2">&quot;none&quot;</span><span class="p">);</span>
</pre></div>
</td></tr></table>
</div>
<p>The value returned by either form of this command is a two-element
list, composed of a Javascript array containing certain formatting
parameters, and a rendered string representing the bibliography
itself.  The first element—the array of formatting parameters—contains
the key/value pairs shown below (the values shown are the processor
defaults):</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3
4</pre></td><td class="code"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;maxoffset&quot;</span><span class="o">:</span> <span class="mi">0</span><span class="o">,</span>
  <span class="s2">&quot;entryspacing&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="o">,</span>
  <span class="s2">&quot;linespacing&quot;</span><span class="o">:</span> <span class="mi">1</span>
<span class="p">};</span>
</pre></div>
</td></tr></table>
</div>
<dl class="docutils">
<dt><em>maxoffset</em></dt>
<dd>Some citation styles apply a label (either a number or an
alphanumeric code) to each bibliography entry, and use this label
to cite bibliography items in the main text.  In the bibliography,
the labels may either be hung in the margin, or they may be set
flush to the margin, with the citations indented by a uniform
amount to the right.  In the latter case, the amount of indentation
needed depends on the maximum width of any label.  The
<tt class="docutils literal"><span class="pre">maxoffset</span></tt> value gives the maximum number of characters that
appear in any label used in the bibliography.  The client that
controls the final rendering of the bibliography string should use
this value to calculate and apply a suitable indentation length.</dd>
<dt><em>entryspacing</em></dt>
<dd>An integer representing the spacing between entries in the bibliography.</dd>
<dt><em>linespacing</em></dt>
<dd>An integer representing the spacing between the lines within
each bibliography entry.</dd>
</dl>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id31" id="makecitationcluster" name="makecitationcluster"><tt class="docutils literal"><span class="pre">makeCitationCluster()</span></tt></a></h2>
<p>Use the <tt class="docutils literal"><span class="pre">makeCitationCluster()</span></tt> command to generate the text
of citations containing one or more references, for insertion into
footnotes or the main text of the document.  This command takes a
single argument, composed of a list of IDs, each accompanied by
a simple Javascript object containing (optional) supplementary data.</p>
<div class="admonition-hint admonition">
<p class="first admonition-title">Hint</p>
<p class="last">See the <img alt="link" src="link.png" /> <a class="reference" href="#citation-fields">Data Input → Citation fields</a> section below concerning
the elements recognized as supplementary data, and their
usage.</p>
</div>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3
4
5
6</pre></td><td class="code"><div class="highlight"><pre><span class="k">var</span> <span class="nx">my_ids</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="s2">&quot;ID-1&quot;</span><span class="o">,</span> <span class="p">{}]</span><span class="o">,</span>
    <span class="p">[</span><span class="s2">&quot;ID-2&quot;</span><span class="o">,</span> <span class="p">{}]</span>
<span class="p">]</span>

<span class="k">var</span> <span class="nx">mycite</span> <span class="o">=</span> <span class="nx">makeCitationCluster</span><span class="p">(</span> <span class="nx">my_ids</span> <span class="p">);</span>
</pre></div>
</td></tr></table>
</div>
</div>
</div>
<div class="section">
<h1><a class="toc-backref" href="#id32" id="local-environment" name="local-environment">Local Environment</a></h1>
<p>While <tt class="docutils literal"><span class="pre">citeproc-js</span></tt> does a great deal of the heavy lifting needed
for correct formatting of citations and bibliographies, a certain
amount of programming is required to prepare the environment for its
correct operation.</p>
<div class="section">
<h2><a class="toc-backref" href="#id33" id="state-aware-data-preparation" name="state-aware-data-preparation">State-aware data preparation</a></h2>
<p>The CSL 1.0 specification anticipates the availability of several
dynamic variables whose value depends upon the sequence and context
of references generated with the <tt class="docutils literal"><span class="pre">makeCitationCluster()</span></tt> command:</p>
<table border="1" class="hello docutils">
<colgroup>
<col width="82%" />
<col width="18%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Variable</th>
<th class="head">Type</th>
</tr>
</thead>
<tbody valign="top">
<tr><td><tt class="docutils literal"><span class="pre">position</span></tt></td>
<td>numeric</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">first-reference-note-number</span></tt></td>
<td>numeric</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">near-note</span></tt></td>
<td>boolean</td>
</tr>
</tbody>
</table>
<p>Correct calculation of these values demands client-specific awareness
of transaction details, such as the identity and position of a
particular footnote within a word processing program or typesetting
system, that is beyond the generic capabilities of the <tt class="docutils literal"><span class="pre">citeproc-js</span></tt>
processor.  It is therefore the responsibility of the calling
application, when invoking <tt class="docutils literal"><span class="pre">makeCitationCluster()</span></tt>, to supply
correct values for these three variables.</p>
<p>A detailed explanation of the role and expected values of these
variables under various processing scenarios is beyond the scope of
this document.  For further information on the role each plays in citation
formatting, please refer to the CSL specification, available via
<a class="reference" href="http://citationstyles.org/">http://citationstyles.org/</a>.</p>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id34" id="system-functions" name="system-functions">System functions</a></h2>
<p>As mentioned above in the section on <img alt="link" src="link.png" /> <a class="reference" href="#csl-engine">CSL.Engine()</a>, two functions
must be defined separately and supplied to the processor upon
instantiation.  These functions are used by the processor to obtain
locale and item data from the surrounding environment.  The exact
definition of each may vary from one system to another; those given below
assume the existence of a global <tt class="docutils literal"><span class="pre">DATA</span></tt> object in the context of the
processor instance, and are provided only for the purpose of
illustration.</p>
<div class="section">
<h3><a class="toc-backref" href="#id35" id="retrievelocale" name="retrievelocale"><tt class="docutils literal"><span class="pre">retrieveLocale()</span></tt></a></h3>
<p>The <tt class="docutils literal"><span class="pre">retrieveLocale()</span></tt> function is used internally by the processor to
retrieve the serialized XML of a given locale.  It takes a single RFC
4646 compliant language tag as argument, composed of a single language
tag (<tt class="docutils literal"><span class="pre">en</span></tt>) or of a language tag and region subtag (<tt class="docutils literal"><span class="pre">en-US</span></tt>).  The
name of the XML document in the CSL distribution that contains the
relevant locale data may be obtained from the <tt class="docutils literal"><span class="pre">CSL.localeRegistry</span></tt>
array.  The sample function below is provided for reference
only.</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3
4</pre></td><td class="code"><div class="highlight"><pre><span class="nx">sys</span><span class="p">.</span><span class="nx">retrieveLocale</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="nx">lang</span><span class="p">){</span>
        <span class="k">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="nx">DATA</span><span class="p">.</span><span class="nx">_locales</span><span class="p">[</span> <span class="nx">CSL</span><span class="p">.</span><span class="nx">localeRegistry</span><span class="p">[</span><span class="nx">lang</span><span class="p">]</span> <span class="p">];</span>
        <span class="k">return</span> <span class="nx">ret</span><span class="o">;</span>
<span class="p">};</span>
</pre></div>
</td></tr></table>
</div>
</div>
<div class="section">
<h3><a class="toc-backref" href="#id36" id="retrieveitem" name="retrieveitem"><tt class="docutils literal"><span class="pre">retrieveItem()</span></tt></a></h3>
<p>The <tt class="docutils literal"><span class="pre">retrieveItem()</span></tt> function is used by the processor to
fetch individual items from storage.</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3</pre></td><td class="code"><div class="highlight"><pre><span class="nx">sys</span><span class="p">.</span><span class="nx">retrieveItem</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="nx">id</span><span class="p">){</span>
        <span class="k">return</span> <span class="nx">DATA</span><span class="p">.</span><span class="nx">_items</span><span class="p">[</span><span class="nx">id</span><span class="p">];</span>
<span class="p">};</span>
</pre></div>
</td></tr></table>
</div>
</div>
</div>
</div>
<div class="section">
<h1><a class="toc-backref" href="#id37" id="data-input" name="data-input">Data Input</a></h1>
<div class="section">
<h2><a class="toc-backref" href="#id38" id="item-fields" name="item-fields">Item fields</a></h2>
<p>The locally defined <tt class="docutils literal"><span class="pre">retrieveItem()</span></tt> function must return data
for the target item as a simple Javascript array containing recognized
CSL fields. <a class="footnote-reference" href="#id11" id="id5" name="id5">[2]</a>  The layout of the three field types is described below.</p>
<div class="section">
<h3><a class="toc-backref" href="#id39" id="text-and-numeric-variables" name="text-and-numeric-variables">Text and numeric variables</a></h3>
<p>Text and numeric variables are not distinguished in the data layer; both
should be presented as simple strings.</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3</pre></td><td class="code"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;title&quot;</span> <span class="o">:</span> <span class="s2">&quot;My Anonymous Life&quot;</span><span class="o">,</span>
  <span class="s2">&quot;volume&quot;</span> <span class="o">:</span> <span class="s2">&quot;10&quot;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
</div>
<div class="section">
<h3><a class="toc-backref" href="#id40" id="names" name="names">Names</a></h3>
<p>When present in the item data, CSL name variables must
be delivered as a list of Javascript arrays, with one
array for each name represented by the variable.
Simple personal names are composed of <tt class="docutils literal"><span class="pre">family</span></tt> and <tt class="docutils literal"><span class="pre">given</span></tt> elements,
containing respectively the family and given name of the individual.</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3
4
5
6
7
8
9</pre></td><td class="code"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;author&quot;</span> <span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="s2">&quot;family&quot;</span> <span class="o">:</span> <span class="s2">&quot;Doe&quot;</span><span class="o">,</span> <span class="s2">&quot;given&quot;</span> <span class="o">:</span> <span class="s2">&quot;Jonathan&quot;</span> <span class="p">}</span><span class="o">,</span>
    <span class="p">{</span> <span class="s2">&quot;family&quot;</span> <span class="o">:</span> <span class="s2">&quot;Roe&quot;</span><span class="o">,</span> <span class="s2">&quot;given&quot;</span> <span class="o">:</span> <span class="s2">&quot;Jane&quot;</span> <span class="p">}</span>
  <span class="p">]</span><span class="o">,</span>
  <span class="s2">&quot;editor&quot;</span> <span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="s2">&quot;family&quot;</span> <span class="o">:</span> <span class="s2">&quot;Saunders&quot;</span><span class="o">,</span>
      <span class="s2">&quot;given&quot;</span> <span class="o">:</span> <span class="s2">&quot;John Bertrand de Cusance Morant&quot;</span> <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
<p>Institutional and other names that should always be presented
literally (such as &quot;The Artist Formerly Known as Prince&quot;,
&quot;Banksy&quot;, or &quot;Ramses IV&quot;) should be delivered as a single
<tt class="docutils literal"><span class="pre">literal</span></tt> element in the name array:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3
4</pre></td><td class="code"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;author&quot;</span> <span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="s2">&quot;literal&quot;</span> <span class="o">:</span> <span class="s2">&quot;Society for Putting Things on Top of Other Things&quot;</span> <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
<div class="section">
<h4><a class="toc-backref" href="#id41" id="names-with-particles" name="names-with-particles">Names with particles</a></h4>
<p>Name particles, such as the &quot;von&quot; in &quot;Werner von Braun&quot;, can
be delivered separately from the family and given name,
as <tt class="docutils literal"><span class="pre">dropping-particle</span></tt> and <tt class="docutils literal"><span class="pre">non-dropping-particle</span></tt> elements.
Name suffixes such as the &quot;Jr.&quot; in &quot;Frank Bennett Jr.&quot; can be
delivered as a <tt class="docutils literal"><span class="pre">suffix</span></tt> element.</p>
<div class="admonition-important admonition">
<p class="first admonition-title">Important</p>
<p class="last">A simplified format for delivering particles and name suffixes
to the processor is described below in the section
<img alt="link" src="link.png" /> <a class="reference" href="#dirty-names">Dirty Tricks → Input data rescue → Names</a>.</p>
</div>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></td><td class="code"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;author&quot;</span> <span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="s2">&quot;family&quot;</span> <span class="o">:</span> <span class="s2">&quot;Humboldt&quot;</span><span class="o">,</span>
      <span class="s2">&quot;given&quot;</span> <span class="o">:</span> <span class="s2">&quot;Alexander&quot;</span><span class="o">,</span>
      <span class="s2">&quot;dropping-particle&quot;</span> <span class="o">:</span> <span class="s2">&quot;von&quot;</span>
    <span class="p">}</span><span class="o">,</span>
    <span class="p">{</span> <span class="s2">&quot;family&quot;</span> <span class="o">:</span> <span class="s2">&quot;Gough&quot;</span><span class="o">,</span>
      <span class="s2">&quot;given&quot;</span> <span class="o">:</span> <span class="s2">&quot;Vincent&quot;</span><span class="o">,</span>
      <span class="s2">&quot;non-dropping-particle&quot;</span> <span class="o">:</span> <span class="s2">&quot;van&quot;</span>
    <span class="p">}</span><span class="o">,</span>
    <span class="p">{</span> <span class="s2">&quot;family&quot;</span> <span class="o">:</span> <span class="s2">&quot;Stephens&quot;</span><span class="o">,</span>
      <span class="s2">&quot;given&quot;</span> <span class="o">:</span> <span class="s2">&quot;James&quot;</span><span class="o">,</span>
      <span class="s2">&quot;suffix&quot;</span> <span class="o">:</span> <span class="s2">&quot;Jr.&quot;</span>
    <span class="p">}</span><span class="o">,</span>
    <span class="p">{</span> <span class="s2">&quot;family&quot;</span> <span class="o">:</span> <span class="s2">&quot;van der Vlist&quot;</span><span class="o">,</span>
      <span class="s2">&quot;given&quot;</span> <span class="o">:</span> <span class="s2">&quot;Eric&quot;</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
</div>
<div class="section">
<h4><a class="toc-backref" href="#id42" id="non-byzantine-names" name="non-byzantine-names"><span id="input-byzantine"></span>&quot;non-Byzantine&quot; names</a></h4>
<p>Names not written in the Latin, Greek, Arabic or Cyrillic
scripts <a class="footnote-reference" href="#id12" id="id7" name="id7">[3]</a> are always displayed
with the family name first.  No special hint is needed in
the input data; the processor is sensitive to the character
set used in the name elements, and will handle such names
appropriately.</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3
4
5
6</pre></td><td class="code"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;author&quot;</span> <span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="s2">&quot;family&quot;</span> <span class="o">:</span> <span class="s2">&quot;村上&quot;</span><span class="o">,</span>
      <span class="s2">&quot;given&quot;</span> <span class="o">:</span> <span class="s2">&quot;春樹&quot;</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
<div class="admonition-hint admonition">
<p class="first admonition-title">Hint</p>
<p class="last">When the romanized transliteration is selected from a multi-lingual
name field, the <tt class="docutils literal"><span class="pre">static-ordering</span></tt> flag is not required.  See the section
<img alt="link" src="link.png" /> <a class="reference" href="#multi-lingual-content">Dirty Tricks → Multi-lingual content</a> below for further details.</p>
</div>
<p>Sometimes it might be desired to handle a Latin or Cyrillic
transliteration as if it were a fixed (non-Byzantine) name.  This
behavior can be prompted by including a <tt class="docutils literal"><span class="pre">static-ordering</span></tt> element in
the name array.  The actual value of the element is irrelevant, so
long as it returns true when tested by the Javascript interpreter.</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3
4
5
6
7</pre></td><td class="code"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;author&quot;</span> <span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="s2">&quot;family&quot;</span> <span class="o">:</span> <span class="s2">&quot;Murakami&quot;</span><span class="o">,</span>
      <span class="s2">&quot;given&quot;</span> <span class="o">:</span> <span class="s2">&quot;Haruki&quot;</span><span class="o">,</span>
      <span class="s2">&quot;static-ordering&quot;</span> <span class="o">:</span> <span class="mi">1</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
</div>
</div>
<div class="section">
<h3><a class="toc-backref" href="#id43" id="dates" name="dates"><span id="input-dates"></span>Dates</a></h3>
<p>Date fields are Javascript arrays, and may contain <tt class="docutils literal"><span class="pre">year</span></tt>, <tt class="docutils literal"><span class="pre">month</span></tt>
and <tt class="docutils literal"><span class="pre">day</span></tt> elements.</p>
<div class="admonition-hint admonition">
<p class="first admonition-title">Hint</p>
<p class="last">A simplified format for providing date input
is described below in the section
<img alt="link" src="link.png" /> <a class="reference" href="#dirty-dates">Dirty Tricks → Input data rescue → Dates</a>.</p>
</div>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3
4</pre></td><td class="code"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;year&quot;</span> <span class="o">:</span> <span class="s2">&quot;2000&quot;</span><span class="o">,</span>
  <span class="s2">&quot;month&quot;</span> <span class="o">:</span> <span class="s2">&quot;1&quot;</span><span class="o">,</span>
  <span class="s2">&quot;day&quot;</span> <span class="o">:</span> <span class="s2">&quot;15&quot;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
<p>Date elements may be expressed either as numeric strings or as
numbers.</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3</pre></td><td class="code"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;year&quot;</span> <span class="o">:</span> <span class="mi">1895</span><span class="o">,</span>
  <span class="s2">&quot;month&quot;</span> <span class="o">:</span> <span class="mi">11</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
<p>The <tt class="docutils literal"><span class="pre">year</span></tt> element may be negative, but never zero.</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2</pre></td><td class="code"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;year&quot;</span> <span class="o">:</span> <span class="o">-</span><span class="mi">200</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
<p>A <tt class="docutils literal"><span class="pre">season</span></tt> element may
also be included.  If present, string or number values between <tt class="docutils literal"><span class="pre">1</span></tt> and <tt class="docutils literal"><span class="pre">4</span></tt>
will be interpreted to correspond to Spring, Summer, Fall, and Winter,
respectively.</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3</pre></td><td class="code"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;year&quot;</span> <span class="o">:</span> <span class="mi">1950</span><span class="o">,</span>
  <span class="s2">&quot;season&quot;</span> <span class="o">:</span> <span class="s2">&quot;1&quot;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
<p>Other string values are permitted in the <tt class="docutils literal"><span class="pre">season</span></tt> element,
but note that these will appear in the output
as literal strings, without localization:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3</pre></td><td class="code"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;year&quot;</span> <span class="o">:</span> <span class="mi">1975</span><span class="o">,</span>
  <span class="s2">&quot;season&quot;</span> <span class="o">:</span> <span class="s2">&quot;Trinity&quot;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
<p>For approximate dates, a <tt class="docutils literal"><span class="pre">circa</span></tt> element should be included,
with a non-nil value:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3</pre></td><td class="code"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;year&quot;</span> <span class="o">:</span> <span class="o">-</span><span class="mi">225</span><span class="o">,</span>
  <span class="s2">&quot;circa&quot;</span> <span class="o">:</span> <span class="mi">1</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
<p>To input a date range, add an element with an <tt class="docutils literal"><span class="pre">_end</span></tt> suffix
to correspond with each <tt class="docutils literal"><span class="pre">year</span></tt>, <tt class="docutils literal"><span class="pre">month</span></tt> and <tt class="docutils literal"><span class="pre">day</span></tt> in
the field data:</p>
<div class="admonition-important admonition">
<p class="first admonition-title">Important</p>
<p class="last">As shown in this example, in ranged input,
<em>all</em> date elements in the input data must have an explicit corresponding
<tt class="docutils literal"><span class="pre">_end</span></tt> counterpart, even when the values are identical.</p>
</div>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3
4
5</pre></td><td class="code"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;year&quot;</span> <span class="o">:</span> <span class="mi">2000</span><span class="o">,</span>
  <span class="s2">&quot;month&quot;</span> <span class="o">:</span> <span class="mi">11</span><span class="o">,</span>
  <span class="s2">&quot;year_end&quot;</span> <span class="o">:</span> <span class="mi">2000</span><span class="o">,</span>
  <span class="s2">&quot;month_end&quot;</span> <span class="o">:</span> <span class="mi">12</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
<p>To specify an open-ended range, pass nil values for the <tt class="docutils literal"><span class="pre">_end</span></tt> elements:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3
4
5</pre></td><td class="code"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;year&quot;</span> <span class="o">:</span> <span class="mi">2008</span><span class="o">,</span>
  <span class="s2">&quot;month&quot;</span> <span class="o">:</span> <span class="mi">11</span><span class="o">,</span>
  <span class="s2">&quot;year_end&quot;</span> <span class="o">:</span> <span class="mi">0</span><span class="o">,</span>
  <span class="s2">&quot;month_end&quot;</span> <span class="o">:</span> <span class="mi">0</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
<p>A literal string may be passed through as a <tt class="docutils literal"><span class="pre">literal</span></tt> element:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2</pre></td><td class="code"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;literal&quot;</span> <span class="o">:</span> <span class="s2">&quot;My Aunt Sally 23&quot;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
</div>
<div class="section">
<h3><a class="toc-backref" href="#id44" id="categories" name="categories">Categories</a></h3>
<p>If bibliographic output must be divided into sections, the category or
categories with which an item should be associated can be indicated by
including a <tt class="docutils literal"><span class="pre">category</span></tt> element.  If present, this element must be a
Javascript array containing a list of category names:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3
4
5
6
7</pre></td><td class="code"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;author&quot;</span> <span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="s2">&quot;family&quot;</span> <span class="o">:</span> <span class="s2">&quot;Derby&quot;</span><span class="o">,</span> <span class="s2">&quot;given&quot;</span> <span class="o">:</span> <span class="s2">&quot;George&quot;</span> <span class="p">}</span>
  <span class="p">]</span><span class="o">,</span>
  <span class="s2">&quot;title&quot;</span> <span class="o">:</span> <span class="s2">&quot;Phoenixiana&quot;</span><span class="o">,</span>
  <span class="s2">&quot;issued&quot;</span> <span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;year&quot;</span> <span class="o">:</span> <span class="mi">1873</span> <span class="p">}</span><span class="o">,</span>
  <span class="s2">&quot;category&quot;</span> <span class="o">:</span> <span class="p">[</span> <span class="s2">&quot;humor&quot;</span><span class="o">,</span> <span class="s2">&quot;satire&quot;</span> <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
</div>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id45" id="citation-fields" name="citation-fields">Citation fields</a></h2>
<p>As noted above under <img alt="link" src="link.png" /> <a class="reference" href="#makecitationcluster">makeCitationCluster()</a>, that function takes
as its single argument a list item IDs, each paired with a Javascript
array containing supplementary data.  The supplementary array must be present,
but may be empty:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3
4</pre></td><td class="code"><div class="highlight"><pre><span class="k">var</span> <span class="nx">my_ids</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="s2">&quot;ID-1&quot;</span><span class="o">,</span> <span class="p">{}]</span><span class="o">,</span>
    <span class="p">[</span><span class="s2">&quot;ID-2&quot;</span><span class="o">,</span> <span class="p">{}]</span>
<span class="p">]</span>
</pre></div>
</td></tr></table>
</div>
<div class="section">
<h3><a class="toc-backref" href="#id46" id="locator" name="locator">Locator</a></h3>
<p>To include pinpoint locator information in a cite, include a <tt class="docutils literal"><span class="pre">locator</span></tt> element
with the string data describing the cited location, and a <tt class="docutils literal"><span class="pre">label</span></tt> element
with a valid CSL label string. <a class="footnote-reference" href="#id13" id="id10" name="id10">[4]</a></p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3
4</pre></td><td class="code"><div class="highlight"><pre><span class="k">var</span> <span class="nx">my_ids</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="s2">&quot;ID-1&quot;</span><span class="o">,</span> <span class="p">{</span> <span class="s2">&quot;locator&quot;</span><span class="o">:</span> <span class="s2">&quot;21&quot;</span><span class="o">,</span> <span class="s2">&quot;label&quot;</span><span class="o">:</span> <span class="s2">&quot;paragraph&quot;</span> <span class="p">}]</span><span class="o">,</span>
    <span class="p">[</span><span class="s2">&quot;ID-2&quot;</span><span class="o">,</span> <span class="p">{}]</span>
<span class="p">]</span>
</pre></div>
</td></tr></table>
</div>
<p>If the <tt class="docutils literal"><span class="pre">label</span></tt> element is not included, a value of &quot;page&quot; will
be assumed.</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3
4</pre></td><td class="code"><div class="highlight"><pre><span class="k">var</span> <span class="nx">my_ids</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="s2">&quot;ID-1&quot;</span><span class="o">,</span> <span class="p">{</span> <span class="s2">&quot;locator&quot;</span><span class="o">:</span> <span class="s2">&quot;21&quot;</span> <span class="p">}]</span><span class="o">,</span>
    <span class="p">[</span><span class="s2">&quot;ID-2&quot;</span><span class="o">,</span> <span class="p">{}]</span>
<span class="p">]</span>
</pre></div>
</td></tr></table>
</div>
<table class="first docutils footnote" frame="void" id="id11" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5" name="id11">[2]</a></td><td>For information on valid CSL variable names, please
refer to the CSL specification, available via <a class="reference" href="http://citationstyles.org/">http://citationstyles.org/</a>.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id12" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id7" name="id12">[3]</a></td><td>The Latin, Greek, Arabic and Cyrillic scripts are referred to here collectively
as &quot;Byzantine scripts&quot;, after the confluence of cultures in the first
millenium that spanned all four.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id13" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id10" name="id13">[4]</a></td><td>For a list of valid CSL locator label strings, see the
CSL specification, available via  <a class="reference" href="http://citationstyles.org/">http://citationstyles.org/</a>.</td></tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="section">
<h1><a class="toc-backref" href="#id47" id="dirty-tricks" name="dirty-tricks">Dirty Tricks</a></h1>
<p>This section presents features of the <tt class="docutils literal"><span class="pre">citeproc-js</span></tt> processor that
are not properly speaking a part of the CSL specification.  Some of
the functionality described here may or may not be found in other CSL
1.0 compliant processors when they arrive on the scene.</p>
<div class="section">
<h2><a class="toc-backref" href="#id48" id="input-data-rescue" name="input-data-rescue">Input data rescue</a></h2>
<div class="section">
<h3><a class="toc-backref" href="#id49" id="id14" name="id14"><span id="dirty-names"></span>Names</a></h3>
<p>Systems that use a simple two-field entry format can encode
<tt class="docutils literal"><span class="pre">non-dropping-particle</span></tt> and <tt class="docutils literal"><span class="pre">dropping-particle</span></tt>
elements on a name by including them in the <tt class="docutils literal"><span class="pre">family</span></tt>
or <tt class="docutils literal"><span class="pre">given</span></tt> fields, respectively:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3
4
5
6
7
8
9</pre></td><td class="code"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;author&quot;</span> <span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="s2">&quot;family&quot;</span> <span class="o">:</span> <span class="s2">&quot;von Humboldt&quot;</span><span class="o">,</span>
       <span class="s2">&quot;given&quot;</span> <span class="o">:</span> <span class="s2">&quot;Alexander&quot;</span>
    <span class="p">}</span><span class="o">,</span>
    <span class="p">{</span> <span class="s2">&quot;family&quot;</span> <span class="o">:</span> <span class="s2">&quot;Gough&quot;</span><span class="o">,</span>
      <span class="s2">&quot;given&quot;</span> <span class="o">:</span> <span class="s2">&quot;Vincent van&quot;</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
<p>The extraction of particles is done by scanning for leading terms that
consist entirely of lowercase letters.  For some names, leading lowercase
terms should be treated as part of the name itself, and not as floating particles.
Such names should (always) be passed to the processor wrapped in quotation marks:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3
4
5
6</pre></td><td class="code"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;author&quot;</span> <span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="s2">&quot;family&quot;</span> <span class="o">:</span> <span class="s2">&quot;\&quot;van der Vlist\&quot;&quot;</span><span class="o">,</span>
       <span class="s2">&quot;given&quot;</span> <span class="o">:</span> <span class="s2">&quot;Eric&quot;</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
</div>
<div class="section">
<h3><a class="toc-backref" href="#id50" id="id15" name="id15"><span id="dirty-dates"></span>Dates</a></h3>
<p>The <tt class="docutils literal"><span class="pre">citeproc-js</span></tt> processor contains its own internal
parsing code for raw date strings.  Clients may take advantage of the
processor's internal parser by supplying date strings as a single
<tt class="docutils literal"><span class="pre">raw</span></tt> element:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2</pre></td><td class="code"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;raw&quot;</span> <span class="o">:</span> <span class="s2">&quot;25 Dec 2004&quot;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
<p>Note that the parsing of raw date strings is not part of the CSL 1.0
standard.  Clients that need to interoperate with other CSL
processors should be capable of preparing input in the form described
above under <a class="reference" href="#input-dates">Data Input → Dates</a>.</p>
</div>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id51" id="journal-abbreviation-lists" name="journal-abbreviation-lists">Journal Abbreviation Lists</a></h2>
<p>To enable automatic abbreviation of journal titles, a set
of Javascript key/value pairs composed of full titles and their
abbreviations may be installed using the <tt class="docutils literal"><span class="pre">setContainerTitleAbbreviations</span></tt>
command, after instantiating the processor.</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></td><td class="code"><div class="highlight"><pre><span class="k">var</span> <span class="nx">abbreviations</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Pacific Rim Law &amp;amp; Policy Journal&quot;</span>
        <span class="o">:</span> <span class="s2">&quot;Pac. Rim L. &amp;amp; Pol&#39;y J.&quot;</span><span class="o">,</span>
    <span class="s2">&quot;Temple Journal of International &amp;amp; Comparative Law&quot;</span>
        <span class="o">:</span> <span class="s2">&quot;Temple J. Int&#39;l &amp;amp; Comp. L.&quot;</span>
<span class="p">};</span>

<span class="k">var</span> <span class="nx">citeproc</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CSL</span><span class="p">.</span><span class="nx">Engine</span><span class="p">(</span><span class="nx">sys</span><span class="o">,</span><span class="nx">style</span><span class="p">);</span>

<span class="nx">citeproc</span><span class="p">.</span><span class="nx">setContainerTitleAbbreviations</span><span class="p">(</span><span class="nx">abbreviations</span><span class="p">);</span>
</pre></div>
</td></tr></table>
</div>
<p>A latter version of the CSL specification may provide for
selecting an appropriate list of abbreviations through
a declaration in the CSL style file itself.  For the present,
this facility is available as a non-standard extension to
the processor.</p>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id52" id="processor-control" name="processor-control">Processor control</a></h2>
<p>In the ordinary operation of the <tt class="docutils literal"><span class="pre">makeCitationCluster()</span></tt> command,
the processor generates citation strings suitable for a given position
in the document.</p>
<div class="section">
<h3><a class="toc-backref" href="#id53" id="author-only" name="author-only"><tt class="docutils literal"><span class="pre">author-only</span></tt></a></h3>
<p>When <tt class="docutils literal"><span class="pre">makeCitationCluster()</span></tt> is invoked with a non-nil <tt class="docutils literal"><span class="pre">author-only</span></tt>
element, everything but the author name in a cite is suppressed.
The name is returned without decorative markup (italics, superscript, and
so forth).</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3</pre></td><td class="code"><div class="highlight"><pre><span class="k">var</span> <span class="nx">my_ids</span> <span class="o">=</span> <span class="p">{</span>
  <span class="p">[</span><span class="s2">&quot;ID-1&quot;</span><span class="o">,</span> <span class="p">{</span><span class="s2">&quot;author-only&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="p">}]</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
<p>You might think that printing the author of a cited work,
without printing the cite itself, is a useless thing to do.
And if that were the end of the story, you would be right ...</p>
</div>
<div class="section">
<h3><a class="toc-backref" href="#id54" id="suppress-author" name="suppress-author"><tt class="docutils literal"><span class="pre">suppress-author</span></tt></a></h3>
<p>To suppress the rendering of names in a cite, include a <tt class="docutils literal"><span class="pre">suppress-author</span></tt>
element with a non-nil value in the supplementary data:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3</pre></td><td class="code"><div class="highlight"><pre><span class="k">var</span> <span class="nx">my_ids</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="s2">&quot;ID-1&quot;</span><span class="o">,</span> <span class="p">{</span> <span class="s2">&quot;locator&quot;</span><span class="o">:</span> <span class="s2">&quot;21&quot;</span><span class="o">,</span> <span class="s2">&quot;suppress-author&quot;</span><span class="o">:</span> <span class="mi">1</span> <span class="p">}]</span>
<span class="p">]</span>
</pre></div>
</td></tr></table>
</div>
<p>This option is useful on its own.  It can also be used in
combination with the <tt class="docutils literal"><span class="pre">author-only</span></tt> element, as described below.</p>
</div>
<div class="section">
<h3><a class="toc-backref" href="#id55" id="automating-text-insertions" name="automating-text-insertions">Automating text insertions</a></h3>
<p>Calls to the <tt class="docutils literal"><span class="pre">makeCitationCluster()</span></tt> command with the <tt class="docutils literal"><span class="pre">author-only</span></tt>
and <tt class="docutils literal"><span class="pre">suppress-author</span></tt> control elements can be used to produce
cites that divide their content into two parts.  This permits the
support of styles such as the Chinese national standard style GB7714-87,
which requires formatting like the following:</p>
<blockquote>
<p><strong>The Discovery of Wetness</strong></p>
<p>While it has long been known that rocks are dry <sup>[1]</sup>
and that air is moist <sup>[2]</sup> it has been suggested by Source [3] that
water is wet.</p>
<p><strong>Bibliography</strong></p>
<p>[1] John Noakes, <em>The Dryness of Rocks</em> (1952).</p>
<p>[2] Richard Snoakes, <em>The Moistness of Air</em> (1967).</p>
<p>[3] Jane Roe, <em>The Wetness of Water</em> (2000).</p>
</blockquote>
<p>In an author-date style, the same passage should be rendered more or
less as follows:</p>
<blockquote>
<p><strong>The Discovery of Wetness</strong></p>
<p>While it has long been known that rocks are dry (Noakes 1952)
and that air is moist (Snoakes 1967) it has been suggested by Roe (2000)
that water is wet.</p>
<p><strong>Bibliography</strong></p>
<p>John Noakes, <em>The Dryness of Rocks</em> (1952).</p>
<p>Richard Snoakes, <em>The Moistness of Air</em> (1967).</p>
<p>Jane Roe, <em>The Wetness of Water</em> (2000).</p>
</blockquote>
<p>In both of the example passages above, the cites to Noakes and Snoakes
can be obtained with ordinary calls to <tt class="docutils literal"><span class="pre">makeCitationCluster()</span></tt>.  The
cite to Roe must be obtained in two parts: the first with a call
controlled by the <tt class="docutils literal"><span class="pre">author-only</span></tt> element; and the second with
a call controlled by the <tt class="docutils literal"><span class="pre">suppress-author</span></tt> element, <em>in that order</em>:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3
4
5</pre></td><td class="code"><div class="highlight"><pre><span class="k">var</span> <span class="nx">my_ids</span> <span class="o">=</span> <span class="p">{</span>
  <span class="p">[</span><span class="s2">&quot;ID-3&quot;</span><span class="o">,</span> <span class="p">{</span><span class="s2">&quot;author-only&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="p">}]</span>
<span class="p">}</span>

<span class="k">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">citeproc</span><span class="p">.</span><span class="nx">makeCitationCluster</span><span class="p">(</span> <span class="nx">my_ids</span> <span class="p">);</span>
</pre></div>
</td></tr></table>
</div>
<p>... and then ...</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3
4
5</pre></td><td class="code"><div class="highlight"><pre><span class="k">var</span> <span class="nx">my_ids</span> <span class="o">=</span> <span class="p">{</span>
  <span class="p">[</span><span class="s2">&quot;ID-3&quot;</span><span class="o">,</span> <span class="p">{</span><span class="s2">&quot;suppress-author&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="p">}]</span>
<span class="p">}</span>

<span class="k">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">citeproc</span><span class="p">.</span><span class="nx">makeCitationCluster</span><span class="p">(</span> <span class="nx">my_ids</span> <span class="p">);</span>
</pre></div>
</td></tr></table>
</div>
<p>In the first call, the processor will automatically suppress decorations (superscripting).
Also in the first call, if a numeric style is used, the processor will provide a localized
label in lieu of the author name, and include the numeric source identifier, free of decorations.
In the second call, if a numeric style is used, the processor will suppress output, since
the numeric identifier was included in the return to the first call.</p>
<p>Detailed illustrations of the interaction of these two control
elements are in the processor test fixtures in the
&quot;discretionary&quot; category:</p>
<ul class="simple">
<li><a class="reference" href="http://bitbucket.org/fbennett/citeproc-js/src/tip/std/humans/discretionary_AuthorOnly.txt">AuthorOnly</a></li>
<li><a class="reference" href="http://bitbucket.org/fbennett/citeproc-js/src/tip/std/humans/discretionary_CitationNumberAuthorOnlyThenSuppressAuthor.txt">CitationNumberAuthorOnlyThenSuppressAuthor</a></li>
<li><a class="reference" href="http://bitbucket.org/fbennett/citeproc-js/src/tip/std/humans/discretionary_CitationNumberSuppressAuthor.txt">CitationNumberSuppressAuthor</a></li>
<li><a class="reference" href="http://bitbucket.org/fbennett/citeproc-js/src/tip/std/humans/discretionary_SuppressAuthorSolo.txt">SuppressAuthorSolo</a></li>
</ul>
</div>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id56" id="id21" name="id21"><span id="multi-lingual-content"></span>Multi-lingual content</a></h2>
<p>The version of <tt class="docutils literal"><span class="pre">citeproc-js</span></tt> described by this manual incorporates
an experimental mechanism for supporting cross-lingual and
mixed-language citation styles, such as 我妻栄 [Wagatsuma Sakae],
<span class="sc">債権各論 [Obligations in Detail]</span> (1969).  While the scheme
described below cannot be considered
a permanent and stable solution to the problem of multi-lingual
citation management, it provides a platform for proof of concept, and
for the development of styles to support more robust multilingual support
when it arrives.</p>
<div class="section">
<h3><a class="toc-backref" href="#id57" id="the-lang-declaration" name="the-lang-declaration">The <tt class="docutils literal"><span class="pre">lang</span></tt> declaration</a></h3>
<p>The <tt class="docutils literal"><span class="pre">style</span></tt> tag in a CSL style may contain a <tt class="docutils literal"><span class="pre">default-locale</span></tt> attribute.</p>
<!-- The clothesline construct below removes the hint box from the
normal flow, so that it overlays the code block below.  This
is necessary wherever the edge of the table containing the
code block might extend to the edge of a hint/important box. -->
<!--  -->
<blockquote class="clothesline">
<div class="admonition-hint admonition">
<p class="first admonition-title">Hint</p>
<p class="last">When the <tt class="docutils literal"><span class="pre">default-locale</span></tt> attribute is omitted,
the default language is set to <tt class="docutils literal"><span class="pre">en-US</span></tt>.</p>
</div>
</blockquote>
<div class="codeblock xml">
<table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></td><td class="code"><div class="highlight"><pre><span class="nt">&lt;style</span>
    <span class="na">xmlns=</span><span class="s">&quot;http://purl.org/net/xbiblio/csl&quot;</span>
    <span class="na">class=</span><span class="s">&quot;in-text&quot;</span>
    <span class="na">version=</span><span class="s">&quot;1.0&quot;</span>
    <span class="na">default-locale=</span><span class="s">&quot;de&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;info&gt;</span>
    <span class="nt">&lt;id</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;title</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;updated&gt;</span>2009-08-10T04:49:00+09:00<span class="nt">&lt;/updated&gt;</span>
  <span class="nt">&lt;/info&gt;</span>
  <span class="nt">&lt;citation&gt;</span>
    <span class="nt">&lt;layout&gt;</span>
      <span class="nt">&lt;names</span> <span class="na">variable=</span><span class="s">&quot;author&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;name</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/names&gt;</span>
    <span class="nt">&lt;/layout&gt;</span>
  <span class="nt">&lt;/citation&gt;</span>
<span class="nt">&lt;/style&gt;</span>
</pre></div>
</td></tr></table>
</div>
<p>For multi-lingual operation, a style may be set to request alternative
versions and translations of the <tt class="docutils literal"><span class="pre">title</span></tt> field, and of the author
and other name fields, using an extension to the <tt class="docutils literal"><span class="pre">default-locale</span></tt>
attribute.  Extensions consist of an extension tag, followed by
a language setting that conforms to <a class="reference" href="http://www.ietf.org/rfc/rfc4646.txt">RFC 4646</a> (typically constructed
from components listed in the <a class="reference" href="http://www.iana.org/assignments/language-subtag-registry">IANA Language Subtag Registry</a>).  Recognized extension
tags are as follows:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">-x-pri-</span></tt></dt>
<dd>Sets a preferred language or translitertion for the title field.</dd>
<dt><tt class="docutils literal"><span class="pre">-x-sec-</span></tt></dt>
<dd>Sets an optional secondary translation for the title field.
If this tag is present, a translation in the target language
will (if available) be placed in square braces immediately  after the title text.</dd>
<dt><tt class="docutils literal"><span class="pre">-x-sort-</span></tt></dt>
<dd>Sets the preferred language or transliteration to be used for both the
title field and for names.</dd>
<dt><tt class="docutils literal"><span class="pre">-x-name-</span></tt></dt>
<dd>Sets the preferred language or transliteration for names.</dd>
</dl>
<p>The tags are applied to a style by appending them to the language
string in the <tt class="docutils literal"><span class="pre">default-locale</span></tt> element:</p>
<div class="codeblock xml">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3
4
5</pre></td><td class="code"><div class="highlight"><pre><span class="nt">&lt;style</span>
    <span class="na">xmlns=</span><span class="s">&quot;http://purl.org/net/xbiblio/csl&quot;</span>
    <span class="na">class=</span><span class="s">&quot;in-text&quot;</span>
    <span class="na">version=</span><span class="s">&quot;1.0&quot;</span>
    <span class="na">default-locale=</span><span class="s">&quot;en-US-x-pri-ja-Hrkt&quot;</span><span class="nt">&gt;</span>
</pre></div>
</td></tr></table>
</div>
<p>Multiple tags may be specified, and tags are cumulative, and for
readability, individual tags may be separated by newlines within the
attribute.  The following will attempt to render titles in either
Pinyin transliteration (for Chinese titles) or Hepburn romanization
(for Japanese titles), sorting by the transliteration.</p>
<div class="codeblock xml">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3
4
5
6
7
8
9</pre></td><td class="code"><div class="highlight"><pre><span class="nt">&lt;style</span>
    <span class="na">xmlns=</span><span class="s">&quot;http://purl.org/net/xbiblio/csl&quot;</span>
    <span class="na">class=</span><span class="s">&quot;in-text&quot;</span>
    <span class="na">version=</span><span class="s">&quot;1.0&quot;</span>
    <span class="na">default-locale=</span><span class="s">&quot;en-US</span>
<span class="s">        -x-pri-zh-Latn-pinyin</span>
<span class="s">        -x-pri-ja-Latn-hepburn</span>
<span class="s">        -x-sort-zh-Latn-pinyin</span>
<span class="s">        -x-pri-ja-Latn-hepburn&quot;</span><span class="nt">&gt;</span>
</pre></div>
</td></tr></table>
</div>
<p>Multi-lingual operation depends upon the presence of alternative
representations of field content embedded in the item data.  When
alternative field content is not availaable, the &quot;real&quot; field content
is used as a fallback.  As a result, configuration of language and
script selection parameters will have no effect when only a single
language is available (as will normally be the case for an ordinary
Zotero data store).</p>
</div>
<div class="section">
<h3><a class="toc-backref" href="#id58" id="title" name="title">Title</a></h3>
<p>For titles, alternative representations are appended
directly to the field content, separated by the appropriate
language tag with a leading and trailing colon:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2</pre></td><td class="code"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;title&quot;</span> <span class="o">:</span> <span class="s2">&quot;民法 :ja-Latn-hepburn-heploc: Minpō :en: Civil Code&quot;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
</div>
<div class="section">
<h3><a class="toc-backref" href="#id59" id="id24" name="id24">Names</a></h3>
<p>For personal names, alternative representations should be presented
as separate &quot;name&quot; entries, immediately following the original
for the name element to which they apply.  For example:</p>
<div class="admonition-hint admonition">
<p class="first admonition-title">Hint</p>
<p class="last">As described above, fixed ordering is used for
<img alt="link" src="link.png" /> <a class="reference" href="#input-byzantine">non-Byzantine names</a>.  When such
names are transliterated, the <tt class="docutils literal"><span class="pre">static-ordering</span></tt> element is
set on them, to preserve their original formatting behavior.</p>
</div>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></td><td class="code"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;author&quot;</span> <span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="s2">&quot;family&quot;</span> <span class="o">:</span> <span class="s2">&quot;穂積&quot;</span><span class="o">,</span>
      <span class="s2">&quot;given&quot;</span> <span class="o">:</span> <span class="s2">&quot;陳重&quot;</span>
    <span class="p">}</span><span class="o">,</span>
    <span class="p">{</span> <span class="s2">&quot;family&quot;</span> <span class="o">:</span> <span class="s2">&quot;:ja-Latn: Hozumi&quot;</span><span class="o">,</span>
      <span class="s2">&quot;given&quot;</span> <span class="o">:</span> <span class="s2">&quot;Nobushige&quot;</span>
    <span class="p">}</span><span class="o">,</span>
    <span class="p">{</span> <span class="s2">&quot;family&quot;</span> <span class="o">:</span> <span class="s2">&quot;中川&quot;</span><span class="o">,</span>
      <span class="s2">&quot;given&quot;</span> <span class="o">:</span> <span class="s2">&quot;善之助&quot;</span>
    <span class="p">}</span><span class="o">,</span>
    <span class="p">{</span> <span class="s2">&quot;family&quot;</span> <span class="o">:</span> <span class="s2">&quot;:ja-Latn: Nakagawa&quot;</span><span class="o">,</span>
      <span class="s2">&quot;given&quot;</span> <span class="o">:</span> <span class="s2">&quot;Zennosuke&quot;</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
</div>
</div>
</div>
<div class="section">
<h1><a class="toc-backref" href="#id60" id="test-suite" name="test-suite">Test Suite</a></h1>
<p><tt class="docutils literal"><span class="pre">Citeproc-js</span></tt> ships with a large bundle of test data and a set of
scripts to run the tests against the processor.  The test framework
should be used to confirm that the system performs correctly after
installation.  This section describes the arrangement of the files,
the internal layout of the human-readable version of the text fixtures,
the scripts used to manage the text fixture bundle, and the commands
used to actually run the tests.</p>
<div class="section">
<h2><a class="toc-backref" href="#id61" id="fixture-layout" name="fixture-layout">Fixture layout</a></h2>
<p>The human-readable version of each test fixture is composed in
the format below.  The five sections <tt class="docutils literal"><span class="pre">MODE</span></tt>, <tt class="docutils literal"><span class="pre">SCHEMA</span></tt>,
<tt class="docutils literal"><span class="pre">RESULT</span></tt>, <tt class="docutils literal"><span class="pre">CSL</span></tt> and <tt class="docutils literal"><span class="pre">INPUT</span></tt> are required.  The sections
may be arranged in any order within the fixture file.  As the
sample below illustrates, text that appears between the section
delimiters is ignored.</p>
<!--  -->
<blockquote class="clothesline">
<div class="admonition-hint admonition">
<p class="first admonition-title">Hint</p>
<p class="last">Three additional sections are available for special
purposes.  The optional sections <tt class="docutils literal"><span class="pre">ABBREVIATIONS</span></tt>, <tt class="docutils literal"><span class="pre">BIBENTRIES</span></tt>,
and <tt class="docutils literal"><span class="pre">CITATIONS</span></tt> are also explained
below.</p>
</div>
</blockquote>
<div class="codeblock text">
<table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51</pre></td><td class="code"><div class="highlight"><pre>&gt;&gt;===== MODE =====&gt;&gt;
citation
&lt;&lt;===== MODE =====&lt;&lt;

&gt;&gt;===== SCHEMA =====&gt;&gt;
0.8
&lt;&lt;===== SCHEMA =====&lt;&lt;


# Everything between the section blocks is
# ignored.  Comment markup can be used for clarity,
but it is not required.


&gt;&gt;===== RESULT =====&gt;&gt;
John Doe
&lt;&lt;===== RESULT =====&lt;&lt;


&gt;&gt;===== CSL =====&gt;&gt;
&lt;style
      xmlns=&quot;http://purl.org/net/xbiblio/csl&quot;
      class=&quot;in-text&quot;
      version=&quot;1.0&quot;&gt;
  &lt;info&gt;
    &lt;id /&gt;
    &lt;title /&gt;
    &lt;updated&gt;2009-08-10T04:49:00+09:00&lt;/updated&gt;
  &lt;/info&gt;
  &lt;citation&gt;
    &lt;layout&gt;
      &lt;names variable=&quot;author&quot;&gt;
        &lt;name /&gt;
      &lt;/names&gt;
    &lt;/layout&gt;
  &lt;/citation&gt;
&lt;/style&gt;
&lt;&lt;===== CSL =====&lt;&lt;


&gt;&gt;===== INPUT =====&gt;&gt;
[{
   &quot;id&quot;:&quot;ID-1&quot;,
   &quot;type&quot;: &quot;book&quot;,
   &quot;author&quot;: [
        { &quot;name&quot;:&quot;Doe, John&quot; }
   ],
   &quot;issued&quot;: {&quot;year&quot;: &quot;1965&quot;, &quot;month&quot;:&quot;6&quot;, &quot;day&quot;:&quot;1&quot;},
   &quot;title&quot;: &quot;His Anonymous Life&quot;
}]
&lt;&lt;===== INPUT =====&lt;&lt;
</pre></div>
</td></tr></table>
</div>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id62" id="preprocessors-forthcoming" name="preprocessors-forthcoming">Preprocessors [forthcoming]</a></h2>
<p>Hello.</p>
<div class="section">
<h3><a class="toc-backref" href="#id63" id="std-grind-py-forthcoming" name="std-grind-py-forthcoming"><tt class="docutils literal"><span class="pre">./std/grind.py</span></tt> [forthcoming]</a></h3>
<p>Hello.</p>
</div>
<div class="section">
<h3><a class="toc-backref" href="#id64" id="tools-maketests-sh-forthcoming" name="tools-maketests-sh-forthcoming"><tt class="docutils literal"><span class="pre">./tools/MAKETESTS.sh</span></tt> [forthcoming]</a></h3>
<p>Hello.</p>
</div>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id65" id="test-runners-forthcoming" name="test-runners-forthcoming">Test runners [forthcoming]</a></h2>
<p>Hello.</p>
<div class="section">
<h3><a class="toc-backref" href="#id66" id="runtests-sh-forthcoming" name="runtests-sh-forthcoming"><tt class="docutils literal"><span class="pre">./runtests.sh</span></tt> [forthcoming]</a></h3>
<p>Hello.</p>
</div>
<div class="section">
<h3><a class="toc-backref" href="#id67" id="test-py-forthcoming" name="test-py-forthcoming"><tt class="docutils literal"><span class="pre">./test.py</span></tt> [forthcoming]</a></h3>
<p>Hello.</p>
</div>
</div>
</div>
<div class="section">
<h1><a class="toc-backref" href="#id68" id="running-the-processor-forthcoming" name="running-the-processor-forthcoming">Running the Processor [forthcoming]</a></h1>
<p>Hello.</p>
<div class="section">
<h2><a class="toc-backref" href="#id69" id="under-python-via-python-spidermonkey-forthcoming" name="under-python-via-python-spidermonkey-forthcoming">Under Python via <tt class="docutils literal"><span class="pre">python-spidermonkey</span></tt> [forthcoming]</a></h2>
<p>Hello.</p>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id70" id="under-java-via-rhino-forthcoming" name="under-java-via-rhino-forthcoming">Under Java via <tt class="docutils literal"><span class="pre">rhino</span></tt> [forthcoming]</a></h2>
<p>Hello.</p>
</div>
</div>
</div>
</body>
</html>
